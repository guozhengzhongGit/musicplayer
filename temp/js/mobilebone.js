!function(t,e){document.MBLOADED||("function"==typeof define&&(define.amd||define.cmd)?define("mobilebone",function(a){return e(t,a)}):t.Mobilebone=e(t,{}))}(this,function(t,e){if(document.MBLOADED)return"Don't repeat load Mobilebone!";var a={},n=[],r=n.slice,i=/^#?\w+(?:[\-_]\w+)*$/i,o="WebkitAppearance"in document.documentElement.style||void 0!==document.webkitHidden,s="pushState"in history&&"replaceState"in history;e.support=s;var l=!1;if(e.VERSION="2.6.2",e.captureLink=!0,e.captureForm=!0,e.rootTransition=t,e.mergeCallback=!0,e.classAnimation="slide",e.classPage="page",e.classMask="mask",e.pushStateEnabled=!0,e.evalScript=!1,window.navigator.userAgent.indexOf("Firefox")>=0&&window.top!==window&&(e.pushStateEnabled=!1),0==s)return e;history.popstate=!1,e.transition=function(t,n,i,l){if(0!=arguments.length&&t!=n){3==arguments.length&&1==isNaN(1*i)&&(l=i,i=l.back),n=n||null,i=i||!1,l=l||{};var u={root:this.rootTransition,form:this.form||this.classAnimation,onpagefirstinto:this.onpagefirstinto,animationstart:this.animationstart,animationend:this.animationend,preventdefault:this.preventdefault,fallback:this.fallback,callback:this.callback},d=function(t){if(!t||!t.getAttribute)return{};var a={},n=c(t.getAttribute("data-params")||"");return["title","root","form"].forEach(function(e){a[e]=t.getAttribute("data-"+e)||n[e]||l[e]||u[e]}),"string"==typeof a.root&&(a.root=e.getFunction(a.root)),["onpagefirstinto","callback","fallback","animationstart","animationend","preventdefault"].forEach(function(r){if(1==e.mergeCallback&&"function"==typeof u[r]){var i=t.getAttribute("data-"+r)||n[r];"function"==typeof a.root[i]?a[r]=function(){u[r].apply(this,arguments),a.root[i].apply(this,arguments)}:"function"==typeof l[r]?a[r]=function(){u[r].apply(this,arguments),l[r].apply(this,arguments)}:a[r]=u[r]}else a[r]=t.getAttribute("data-"+r)||n[r]||l[r]||u[r]}),a},f=d(n),p=d(t);if(null!=n&&n.classList){var m=f.preventdefault,h=!1;"string"==typeof m&&(m=f.root[m])}if(null!=t&&t.classList){var y=p.preventdefault,g=!1;"string"==typeof y&&(y=p.root[y])}if("function"==typeof m&&(h=m.call(f.root,t,n,l)),1==h&&m===y)return!1;if("function"==typeof y&&(g=y.call(p.root,t,n,l)),1==g)return!1;var v=function(t,e){1!=t.flagAniBind&&["animationstart","animationend"].forEach(function(a,n){var r=p[a],i="webkit"+a.replace(/^a|s|e/g,function(t){return t.toUpperCase()}),s=o?i:a;n&&t.addEventListener(s,function(){0==this.classList.contains("in")&&(this.style.display="none",1==this.removeSelf&&(this.parentElement.removeChild(this),this.removeSelf=null)),this.classList.remove(d(this).form)}),"string"==typeof r&&p.root[r]?t.addEventListener(s,function(){e.root[r].call(e.root,this,this.classList.contains("in")?"into":"out",l)}):"function"==typeof r&&t.addEventListener(s,function(){r.call(e.root,this,this.classList.contains("in")?"into":"out",l)}),t.flagAniBind=!0})};if(null!=n&&n.classList&&1!=h){n.classList.add(f.form),n.offsetWidth=n.offsetWidth,n.style.display="block",n.classList.add("out"),n.classList.remove("in"),n.classList[i?"add":"remove"]("reverse"),n.removeSelf=n.removeSelf||null,v(n,f);var b=f.fallback;"string"==typeof b&&(b=f.root[b]),"function"==typeof b&&b.call(f.root,t,n,l)}if(null!=t&&t.classList){var k=p.title,A=document.querySelector("h1"),E=document.querySelector("."+this.classPage);k&&l.title!==!1?(document.title=k,A&&(A.innerHTML=k,A.title=k)):E==t&&!n&&document.title&&t.setAttribute("data-title",document.title);var L=l.id||t.id,w=l.id||t.id;l.id&&(L=L.split("?")[0]);var S=a["_"+L];l.remove!==!1&&a[L]&&a[L]!=t&&(S&&a[S]&&1==l.reload&&(delete a[S],delete a["_"+L]),a[L]!=n?a[L].parentElement&&a[L].parentElement.removeChild(a[L]):n.removeSelf=!0,delete a[L]),n&&t.classList.add(p.form),t.offsetWidth=t.offsetWidth,t.style.display="block",t.classList.remove("out"),t.classList.add("in"),t.classList[i?"add":"remove"]("reverse");var T=p.onpagefirstinto;t.firstintoBind||("string"==typeof T&&p.root[T]?p.root[T].call(p.root,t,n,l):"function"==typeof T&&T.call(p.root,t,n,l),r.call(t.querySelectorAll("form")).forEach(function(t){e.submit(t)}),t.firstintoBind=!0),v(t,p);var B=w,C="";B&&0==/^#/.test(B)&&(B="#"+B),C=B.replace(/^#/,"#&"),s&&this.pushStateEnabled&&l.history!==!1&&B&&C!=location.hash&&(history.popstate=!1,history[n?"pushState":"replaceState"](null,document.title,B.replace(/^#/,"#&"))),a[L]||(a[L]=t,w!==L&&(a[w]=t,a["_"+L]=w));var P=p.callback;"string"==typeof P&&(P=p.root[P]),"function"==typeof P&&P.call(p.root,t,n,l),setTimeout(function(){history.popstate=!0},17)}}},e.getCleanUrl=function(t,e,a){var n="",i="",o="";if(t)if(1==t.nodeType)if(t.action){if(n=t.getAttribute("action"),t.method&&"POST"==t.method.toUpperCase())return n;window.$&&$.fn&&$.fn.serialize?i=$(t).serialize():(i={},r.call(t.querySelectorAll("input,select,textarea")).forEach(function(t){if(t.name&&!t.disabled){var e=t.value.trim(),a=t.name;/^radio|checkbox/i.test(t.type)?t.checked&&(i[a]?i[a].push(e):i[a]=[e]):i[a]=[e]}}))}else{n=t.getAttribute("href"),i=t.getAttribute("data-formdata")||t.getAttribute("data-data")||"";var s=t.getAttribute("data-container");if(i.indexOf("container")==-1&&s){var l="container="+s;i=i?i+"&"+l:l}}else t.url&&(n=t.url,i=t.data);if(!(n=n||e))return"";if("object"==typeof(i=i||a||"")){var c=[];for(key in i)i[key].forEach||(i[key]=[i[key]]),i[key].forEach(function(t){c.push(key+"="+encodeURIComponent(t))});i=c.length>0?c.join("&"):""}return o=n.split("#")[0].replace(/&+$/,""),"?"==o.slice(-1)&&(o=o.split("?")[0]),""!=i&&(/\?/.test(o)?(i=i.replace(/^&|\?/,""),o=o+"&"+i):""!=i&&(i=i.replace("?",""),o=o+"?"+i)),o},e.createPage=function(t,n,i){var o=null,s=null,l=this.classPage,c=null;if(t){void 0===i&&"object"==typeof n&&(i=n),i=i||{};var u,d,f,p={};n&&(1==n.nodeType?((n.href||n.action)&&(u=n.getAttribute("data-title")||i.title),o=i.response,d=n.getAttribute("data-container"),s=document.getElementById(d),f=n.getAttribute("data-classpage"),p.target=n,c=n.getAttribute("data-reload"),("form"==n.tagName.toLowerCase()||null!==c&&"false"!=c)&&(p.reload=!0),p.back="back"==n.getAttribute("data-rel"),"false"==n.getAttribute("data-history")&&(p.history=!1)):(o=n.response||i.response,u=n.title||i.title,s=n.container||i.container,f=n.classPage||i.classPage,p.target=n.target,p.back=n.back||i.back),s&&f&&(l=f));var m=(l==f?s:document).querySelector(".in."+l),h=null,y=document.createElement("div");"string"==typeof t?y.innerHTML=t:y.appendChild(t),1==e.evalScript&&1!=t.firstintoBind&&r.call(y.getElementsByTagName("script")).forEach(function(t){var e=t.innerHTML.trim(),a=t.getAttribute("type");if(""!=e.trim()&&!t.src){var n=document.getElementsByTagName("head")[0]||document.documentElement,r=document.createElement("script");a&&(r.type=a),r.appendChild(document.createTextNode(e)),setTimeout(function(){n.insertBefore(r,n.firstChild),n.removeChild(r),r=null},17),t=null}});var g=y.getElementsByTagName("title")[0];(h=y.querySelector("."+l))||(y.className=l+" out",h=y),"string"==typeof u?h.setAttribute("data-title",u):g&&g.innerText&&h.setAttribute("data-title",g.innerText),p.response=o||t,p.id=this.getCleanUrl(n)||h.id||"unique"+Date.now(),"object"==typeof i&&(void 0!==i.history&&(p.history=i.history),void 0!==i.remove&&(p.remove=i.remove),void 0!==i.target&&(p.target=i.target),void 0!==i.title&&(p.title=i.title)),l==f&&(p.history=!1,p.classPage=l),s=s||document.body;var v=p.id.split("?")[0];v&&a[v]&&s.contains(a[v])?s.insertBefore(h,a[v]):s.appendChild(h),y=null,this.transition(h,m,p)}},e.getFunction=function(e){if("string"==typeof e){for(var a=t,n=e.split("."),r=0;r<n.length&&(a=a[n[r]]);r+=1);return a}},e.ajax=function(t){if(t){var a,n={url:"",type:"",dataType:"",data:{},timeout:1e4,async:!0,username:"",password:"",success:function(){},error:function(){},complete:function(){}},r={},i=null,o=null,s={};if(1==t.nodeType){s=c(t.getAttribute("data-params")||"");for(key in n)r[key]=t.getAttribute("data-"+key)||s[key]||n[key],"function"==typeof n[key]&&"string"==typeof r[key]&&(r[key]=this.getFunction(r[key]),"function"!=typeof r[key]&&(r[key]=n[key]));r.url=this.getCleanUrl(t,r.url),r.target=t,r.back="back"==t.getAttribute("data-rel");var l=t.tagName.toLowerCase();if("form"==l)r.type=t.method,o=new FormData(t);else if("a"==l){var u=t.getAttribute("data-container"),d=t.getAttribute("data-classpage"),f=u&&document.getElementById(u);f&&d&&d!=e.classPage&&(r.history=!1,r.title=!1)}a=t.getAttribute("data-mask"),"true"!=a&&""!=a||(i=t.querySelector("."+this.classMask))}else{if(!t.url)return;for(key2 in n)r[key2]=t[key2]||n[key2];r.url=this.getCleanUrl(null,r.url,r.data),r.title=t.title,r.back=t.back,r.container=t.container}var p=f||document.body;"string"!=typeof a&&(i=p.querySelector("."+this.classMask)),null==i&&(i=document.createElement("div"),i.className=this.classMask,i.innerHTML='<i class="loading"></i>',"string"==typeof a?t.appendChild(i):p.appendChild(i)),i.style.display="block";var m=new XMLHttpRequest;m.open(r.type||"GET",r.url+(/\?/.test(r.url)?"&":"?")+"r="+Date.now(),r.async,r.username,r.password),m.timeout=r.timeout,m.onload=function(){var a=null;if(200==m.status){if("json"==r.dataType||"JSON"==r.dataType)try{a=JSON.parse(m.response),r.response=a,e.createPage(e.jsonHandle(a),t,r)}catch(t){r.message="JSON parse errorï¼š"+t.message,r.error.call(r,m,m.status)}else if("unknown"==r.dataType){r.history=!1;try{a=JSON.parse(m.response),r.response=a,e.createPage(e.jsonHandle(a),t,r)}catch(n){a=m.response,e.createPage(a,t,r)}}else a=m.response,e.createPage(a,t,r);r.success.call(r,a,m.status)}else r.message="The status code exception!",r.error.call(r,m,m.status);r.complete.call(r,m,m.status),i.style.display="none"},m.onerror=function(t){r.message="Illegal request address or an unexpected network error!",r.error.call(r,m,m.status),i.style.display="none"},m.ontimeout=function(){r.message="The request timeout!",r.error.call(r,m,m.status),i.style.display="none"},m.setRequestHeader("Type","ajax"),m.setRequestHeader("From","mobilebone"),m.send(o)}},e.submit=function(t){if(t&&"string"==typeof t.action){var a=t.getAttribute("data-ajax");"false"==a||0==e.captureForm&&"true"!=a||t.addEventListener("submit",function(t){var a=this.getAttribute("data-preventdefault"),n=e.getFunction(a);if("function"==typeof n&&1==n(this))return t.preventDefault(),!1;e.ajax(this),t.preventDefault()})}},e.isBack=function(t,e){return 1==history.tempBack?(history.tempBack=null,!0):void 0===t||!!e&&4==t.compareDocumentPosition(e)},e.jsonHandle=function(t){return'<p style="text-align:center;">Dear master, if you see me, show that JSON parsing function is undefined!</p>'},e.init=function(){if(1==l)return"Don't repeat initialization!";var a=location.hash.replace("#&","#"),n=null,r=null;""==a||"#"==a?this.transition(document.querySelector("."+this.classPage)):1==i.test(a)&&(n=document.querySelector(a))&&n.classList.contains(this.classPage)?this.transition(n):(2==a.split("container=").length&&(r=document.getElementById(a.split("container=")[1].split("&")[0])),this.ajax({url:a.replace("#",""),dataType:"unknown",container:r,error:function(){n=document.querySelector("."+e.classPage),e.transition(n)}}));var o=t.$||t.jQuery||t.Zepto;o&&o.fn&&o.fn.tap&&"ontouchstart"in window==1?(o(document).tap(this.handleTapEvent),document.addEventListener("click",function(t){var a=t.target;if(a&&("a"==a.tagName.toLowerCase()||(a=a.getParentElementByTag("a")))){var n=a.getAttribute("data-ajax"),r=a.href;if("external"==a.getAttribute("data-rel")||"false"==n||r.replace("://","").split("/")[0]!==location.href.replace("://","").split("/")[0]&&"true"!=n||0==e.captureLink&&"true"!=n)return void(/^http/i.test(r)&&(location.href=r));t.preventDefault()}})):document.addEventListener("click",this.handleTapEvent);var s=!!navigator.userAgent.match(/safari/i)&&!navigator.userAgent.match(/chrome/i)&&void 0!==document.hidden&&!window.chrome;"ontouchstart"in window==1&&s&&(document.addEventListener("touchmove",function(){history.popstateswipe=!0}),document.addEventListener("touchend",function(){history.popstateswipe=!1})),l=!0},e.handleTapEvent=function(t){var n=null;t&&1==t.nodeType&&(n=t,n.preventDefault=function(){}),n=n||t.target||t.touches[0],href=n.href,href&&0!=/a/i.test(n.tagName)||!(n=n.getParentElementByTag("a"))||(href=n.href);var r=document.querySelector(".in."+e.classPage);if(null!=r&&n){var i={target:n},o=n.getAttribute("data-preventdefault")||c(n.getAttribute("data-params")||"").preventdefault,s=e.getFunction(o);if("function"==typeof s&&1==s(n))return t.preventDefault(),!1;var l=n.getElementsByClassName(e.classMask)[0];if(l&&"none"!=l.style.display)return t.preventDefault(),!1;var u=n.getAttribute("data-container"),d=n.getAttribute("data-classpage"),f=u&&document.getElementById(u);f&&d&&d!=e.classPage&&(r=f.querySelector(".in."+d)||f.querySelector(d),i.history=!1,i.title=!1,i.classPage=d);var p=1==e.captureLink,m=n.getAttribute("data-rel"),h=!1;"back"==m&&(h=!0);var y="external"==m;if(href){if(href=href.replace("#&","#"),""===n.getAttribute("href").replace(/#/g,""))return void t.preventDefault();if(/^javascript/.test(href)){if(0==h)return}else if((1==(y=y||href.replace("://","").split("/")[0]!==location.href.replace("://","").split("/")[0])||0==p)&&"true"!=n.getAttribute("data-ajax"))return;if(1==/^#/.test(n.getAttribute("href"))){var g=href.split("#")[1],v=g&&document.getElementById(g);0==h&&"auto"==m&&(h=e.isBack(v,r)),v&&e.transition(v,r,h,i),t.preventDefault()}else if(/^javascript/.test(href))history.tempBack=!0,history.back();else if("false"!=n.getAttribute("data-ajax")){var b=e.getCleanUrl(n),k=n.getAttribute("data-reload");n.getAttribute("href");if(null!=k&&"false"!=k||!a[b])e.ajax(n);else{0==h&&"auto"==m&&(h=e.isBack(a[b],r)),i.id=b;var A=f||document.body;0==A.contains(a[b])&&A.appendChild(a[b]),e.transition(a[b],r,h,i)}t.preventDefault()}}}},Element.prototype.getParentElementByTag=function(t){if(!t)return null;var e=null,a=this,n=function(){if(!(a=a.parentElement))return null;var r=a.tagName.toLowerCase();r===t?e=a:"body"==r?e=null:n()};return n(),e};var c=function(t){var e={};return"string"==typeof t&&t.split("&").forEach(function(t){var a=t.split("=");a.length>1&&(e[a[0]]=t.replace(a[0]+"=",""))}),e};return window.addEventListener("DOMContentLoaded",function(){0==l&&e.init()}),window.addEventListener("popstate",function(){if(1==history.popstateswipe)return location.reload(),void(history.popstateswipe=!1);if(0==history.popstate)return void(history.popstate=!0);var t=location.hash.replace("#&","").replace(/^#/,""),n=null,r=null;if(""==t){if(n=document.querySelector("."+e.classPage),n.id)return}else if(n=a[t],2==t.split("container=").length&&(r=document.getElementById(t.split("container=")[1].split("&")[0])),n&&0==i.test(t))return void e.transition(n,(r||document).querySelector(".in."+e.classPage),!0,{id:t,history:!1,container:r});if(!n){if(0==i.test(t))return void e.ajax({url:t,dataType:"unknown",back:e.isBack(),container:r});n=document.querySelector("#"+t)}var o=document.querySelector(".in."+e.classPage);n&&n==o||0==e.pushStateEnabled||n&&e.transition(n,o,e.isBack(n,o),{id:t,history:!1,remove:!1})}),document.MBLOADED=!0,e});