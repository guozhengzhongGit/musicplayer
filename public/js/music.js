function validateTime(t){var e=(t>10?t+"":"0"+t).substring(0,2);return isNaN(e)?"00":e}function formatArtists(t){var e=[];return $.each(t,function(t,c){e.push(c.name)}),e.join("/")}!function(t,e){var c=t.documentElement,n="onorientationchange"in window?"orientationchange":"resize",i=function(){var t=c.clientWidth;t&&(c.style.fontSize=t/320*20+"px")};e.addEventListener(n,i,!1),t.addEventListener("DOMContentLoaded",i,!1)}(document,window);var ctx={$playList:null,$listContent:null,playList:null,player:null,currentSong:null,$needle:null,currentIndex:0,$curTime:null,$totTime:null,$processBtn:null,$processBar:null,$rdyBar:null,$curBar:null,$playBtn:null,$pauseBtn:null,canvas:null,backImage:null,interval:0,processBtnState:0,originX:0,diskCovers:[],isPlaying:!1,songUpdated:!0,singleLoop:!1};ctx.init=function(){ctx.initData(),ctx.initState(),ctx.initPlayList(),ctx.updateSong(),ctx.setInterval(),ctx.initProcessBtn(ctx.$processBtn),ctx.updateCoverState(0)},ctx.initData=function(){ctx.currentIndex=+localStorage.getItem("currentSongIndex")||0,ctx.currentIndex>=ctx.playList.length&&(ctx.currentIndex=0),ctx.currentSong=ctx.playList[ctx.currentIndex],ctx.player=$("#mymusicplayer").get(0),ctx.$needle=$("#mymusicneedle"),ctx.$curTime=$("#currentTime"),ctx.$totTime=$("#totalTime"),ctx.$processBtn=$("#processBtn"),ctx.$processBar=$("#mymusicprocess .process-bar"),ctx.$rdyBar=$("#mymusicprocess .rdy"),ctx.$curBar=$("#mymusicprocess .cur"),ctx.$playBtn=$("#mymusiccontrols .play"),ctx.$pauseBtn=$("#mymusiccontrols .pause"),ctx.$playList=$("#mymusicplayList"),ctx.$listContent=$("#listContent"),ctx.diskCovers=[$(".disk-cover:eq(0)"),$(".disk-cover:eq(1)"),$(".disk-cover:eq(2)")]},ctx.loop=function(){ctx.singleLoop=!ctx.singleLoop,$("#mymusiccontrols .loop-btn").toggleClass("active")},ctx.initPlayList=function(){var t;ctx.$listContent.html(""),$("#playListCount").html(ctx.playList.length),$.each(ctx.playList,function(e,c){t=$("<li>").html(c.name).append($("<span>").html("   -"+formatArtists(c.artists))),t.on("click touch",function(){ctx.currentIndex!==e&&(ctx.isPlaying=!0,ctx.moveTo(e))}),ctx.$listContent.append(t)}),ctx.validatePlayList(),ctx.$playList.css("bottom",-(ctx.$playList.height()+50)+"px")},ctx.showPlayList=function(){ctx.$playList.animate({bottom:"0px"},200)},ctx.hidePlayList=function(){ctx.$playList.animate({bottom:-ctx.$playList.height()+"px"},200)},ctx.validatePlayList=function(){ctx.$listContent.children("li.active").removeClass("active").children("div.song-play").remove(),ctx.$listContent.children("li").eq(ctx.currentIndex).addClass("active").prepend($("<div>").addClass("song-play")),ctx.$listContent.animate({scrollTop:41*(ctx.currentIndex+1)-ctx.$listContent.height()/2})},ctx.initState=function(){$("img").attr("draggable",!1),ctx.player.addEventListener("ended",function(){ctx.singleLoop?ctx.moveTo(ctx.currentIndex):ctx.next()}),ctx.player.addEventListener("canplay",ctx.readyToPlay),window.addEventListener("resize",ctx.updateCoverState),$("body").on("click touch",function(t){0!==$(t.target).parents("#mymusicplayList").length||$(t.target).hasClass("list-btn")||ctx.hidePlayList()})},ctx.updateCoverState=function(t,e){var c,n=ctx.currentIndex-1<0?ctx.playList.length-1:ctx.currentIndex-1,i=ctx.currentIndex+2>ctx.playList.length?0:ctx.currentIndex+1,s=-ctx.diskCovers[0].width(),a=ctx.diskCovers[0].parent().width()+ctx.diskCovers[0].width()/2,o=function(){ctx.diskCovers[0].children(".album").attr("src",ctx.playList[n].album.picUrl),ctx.diskCovers[1].children(".album").attr("src",ctx.playList[ctx.currentIndex].album.picUrl),ctx.diskCovers[2].children(".album").attr("src",ctx.playList[i].album.picUrl)},l=function(){ctx.songUpdated||(o(),ctx.updateSong(),ctx.songUpdated=!0)},r=function(){ctx.changeAnimationState(ctx.diskCovers[0],"paused"),ctx.changeAnimationState(ctx.diskCovers[2],"paused")};1===t?(ctx.songUpdated=!1,c=ctx.diskCovers[0],ctx.diskCovers[0]=ctx.diskCovers[1],ctx.diskCovers[1]=ctx.diskCovers[2],ctx.diskCovers[2]=c,r(),e&&ctx.diskCovers[1].children(".album").attr("src","img/placeholder_disk_play_song.png"),ctx.diskCovers[2].css("left",a),ctx.diskCovers[1].animate({left:"10%"},800,l),ctx.diskCovers[0].animate({left:s},800,l)):t===-1?(ctx.songUpdated=!1,c=ctx.diskCovers[2],ctx.diskCovers[2]=ctx.diskCovers[1],ctx.diskCovers[1]=ctx.diskCovers[0],ctx.diskCovers[0]=c,r(),ctx.diskCovers[0].css("left",s),ctx.diskCovers[1].animate({left:"10%"},800,l),ctx.diskCovers[2].animate({left:a},800,l)):(ctx.songUpdated=!0,ctx.diskCovers[0].css("left",s).show(),ctx.diskCovers[1].css("left","10%").show(),ctx.diskCovers[2].css("left",a).show(),o())},ctx.changeAnimationState=function(t,e){t.css({"animation-play-state":e,"-webkit-animation-play-state":e})},ctx.updateSong=function(){ctx.player.src=ctx.currentSong.mp3Url,setTimeout(ctx.updatePic,10),ctx.updateMusicInfo(),ctx.isPlaying&&setTimeout(ctx.play,500),localStorage.setItem("currentSongIndex",ctx.currentIndex)},ctx.updatePic=function(){$(".bg").css("background-image","url("+ctx.currentSong.album.picUrl+")")},ctx.updateMusicInfo=function(){$("#songName").html(ctx.currentSong.name),$("#artist").html(formatArtists(ctx.currentSong.artists))},ctx.play=function(){ctx.player.play(),ctx.isPlaying=!0,ctx.changeAnimationState(ctx.diskCovers[1],"running"),ctx.moveNeedle(!0),ctx.$playBtn.hide(),ctx.$pauseBtn.show()},ctx.pause=function(){ctx.player.pause(),ctx.isPlaying=!1,ctx.moveNeedle(!1),ctx.changeAnimationState(ctx.diskCovers[1],"paused"),ctx.$playBtn.show(),ctx.$pauseBtn.hide()},ctx.moveNeedle=function(t){t?ctx.$needle.removeClass("pause-needle").addClass("resume-needle"):ctx.$needle.removeClass("resume-needle").addClass("pause-needle")},ctx.preSwitchSong=function(){ctx.songUpdated=!1,ctx.currentSong=ctx.playList[ctx.currentIndex],ctx.player.pause(),ctx.moveNeedle(!1),ctx.validatePlayList()},ctx.moveTo=function(t){ctx.songUpdated&&(ctx.currentIndex=t,ctx.preSwitchSong(),setTimeout("ctx.updateCoverState(1,true)",ctx.isPlaying?400:0))},ctx.next=function(){ctx.songUpdated&&(ctx.currentIndex=ctx.currentIndex<ctx.playList.length-1?ctx.currentIndex+1:0,ctx.preSwitchSong(),setTimeout("ctx.updateCoverState(1)",ctx.isPlaying?400:0))},ctx.prev=function(){ctx.songUpdated&&(ctx.currentIndex=ctx.currentIndex>0?ctx.currentIndex-1:ctx.playList.length-1,ctx.preSwitchSong(),setTimeout("ctx.updateCoverState(-1)",ctx.isPlaying?400:0))},ctx.updateProcess=function(){var t=ctx.player.buffered,e=t.length>0?t.end(t.length-1):0,c=ctx.player.duration,n=ctx.player.currentTime;ctx.$totTime.text(validateTime(c/60)+":"+validateTime(c%60)),ctx.$rdyBar.width(e/c*100+"%"),ctx.processBtnState||(ctx.$curBar.width(n/c*100+"%"),ctx.$curTime.text(validateTime(n/60)+":"+validateTime(n%60)))},ctx.setInterval=function(){ctx.interval||(ctx.updateProcess(),ctx.interval=setInterval(ctx.updateProcess,1e3))},ctx.clearInterval=function(){ctx.interval&&clearInterval(ctx.interval)},ctx.initProcessBtn=function(t){var e=function(t){var e,c,n,i=ctx.player.duration,t=t.originalEvent,s=ctx.$processBar.width();console.log(s),t.preventDefault(),ctx.processBtnState&&(c=(t.clientX||t.touches[0].clientX)-ctx.originX,n=ctx.$curBar.width()+c,n>s||n<0?ctx.processBtnState=0:(e=n/s,ctx.$curBar.width(n),ctx.$curTime.text(validateTime(e*i/60)+":"+validateTime(e*i%60))),ctx.originX=t.clientX||t.touches[0].clientX)},c=function(t){t=t.originalEvent,ctx.processBtnState=1,ctx.originX=t.clientX||t.touches[0].clientX},n=function(){ctx.processBtnState&&(ctx.player.currentTime=ctx.$curBar.width()/ctx.$processBar.width()*ctx.player.duration,ctx.processBtnState=0,ctx.updateProcess())};t.on("mousedown touchstart",c),$("body").on("mouseup touchend",n),$("#mymusicprocess").on("mousemove touchmove",e)},$(document).ready(function(){function t(){o++,8==o&&$("#findmusic>.showimg>.num>li").eq(0).addClass("active").siblings().removeClass("active"),9==o&&(o=1,$("#findmusic>.showimg>.findmusic-img").css({left:0})),$("#findmusic>.showimg>.num>li").eq(o).addClass("active").siblings().removeClass("active"),$("#findmusic>.showimg>.findmusic-img").stop().animate({left:-o*n})}function e(){o--,o==-1&&($("#findmusic>.showimg>.findmusic-img").css({left:-8*n}),o=7),$("#findmusic>.showimg>.num>li").eq(o).addClass("active").siblings().removeClass("active"),$("#findmusic>.showimg>.findmusic-img").stop().animate({left:-o*n})}function c(t){$.ajax("/download",{type:"GET",data:t,dataType:"json",success:function(t){console.log(t),ctx.playList=t.result.tracks,ctx.init()},err:function(t){console.log(t)}})}$(".nav-list>ul>li").eq(0).addClass("active"),$("#findmusic>.showimg>.num>li").eq(0).addClass("active");var n=parseInt($(window).width());$(".footer>ul>li>a").on("click",function(){$(".footer>ul>li>a").removeClass("active"),$(this).addClass("active")}),$(".nav-list>ul>li").on("click",function(){$(this).addClass("active").siblings().removeClass("active")});var i,s,a,o=0,l=setInterval(function(){t()},1500);a=20,$("#findmusic>.showimg").on("touchstart",function(t){i=t.originalEvent.touches[0].clientX,console.log(i)}),$("#findmusic>.showimg").on("touchmove",function(t){s=t.originalEvent.touches[0].clientX,console.log(s)}),$("#findmusic>.showimg").on("touchend",function(c){Math.abs(i-s)>a&&console.log(i>s?t():e())}),$(".showimg").on("touchmove",function(){clearInterval(l)}),$(".showimg").on("touchend",function(){clearInterval(l),l=setInterval(function(){t()},1500)});$(".musicbox-box>.musicbox-content>a>img").on("click",function(){$(".footer>ul>li>a").removeClass("active"),$(".footer>ul>li:nth-child(2)>a").addClass("active")}),$("#playmusicone").on("click",function(){c({id:"618628669"})}),$("#playmusictwo").on("click",function(){c({id:"618468325"})}),$("#playmusicthree").on("click",function(){c({id:"583004327"})}),$("#playmusicfour").on("click",function(){c({id:"624049069"})}),$("#playmusicfive").on("click",function(){c({id:"629612003"})}),$("#playmusicsix").on("click",function(){c({id:"625206396"})}),$("#playmusicseven").on("click",function(){c({id:"628357643"})}),$("#playmusiceight").on("click",function(){c({id:"624403999"})}),$("#playmusicnine").on("click",function(){c({id:"621919493"})})});